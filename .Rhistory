nomonetario$edba_nm[(decena==7 & is.na(decena)!=TRUE)]=nomonetario$edba_nm[(decena==7 & is.na(decena)!=TRUE)]/d7m09
nomonetario$edba_nm[(decena==8 & is.na(decena)!=TRUE)]=nomonetario$edba_nm[(decena==8 & is.na(decena)!=TRUE)]/d7m09
nomonetario$edba_nm[(decena==9 & is.na(decena)!=TRUE)]=nomonetario$edba_nm[(decena==9 & is.na(decena)!=TRUE)]/d7m10
nomonetario$edba_nm[(decena==0 & is.na(decena)!=TRUE)]=nomonetario$edba_nm[(decena==0 & is.na(decena)!=TRUE)]/d7m10
#Gasto en Cuidado personal deflactado (mensual)
for(i in 1:26){
gas_cuiper=1000+i
string=paste("D", substr(as.character(gas_cuiper), 2, 4),  sep = "")
nomonetario$cuip_nm[(clave==string & is.na(clave)!=TRUE)]=nomonetario$gasnomon[(clave==string & is.na(clave)!=TRUE)]
}
nomonetario$cuip_nm[(clave=="H132" & is.na(clave)!=TRUE)]=nomonetario$gasnomon[(clave=="H132" & is.na(clave)!=TRUE)]
nomonetario$cuip_nm[(decena==1 & is.na(decena)!=TRUE)]=nomonetario$cuip_nm[(decena==1 & is.na(decena)!=TRUE)]/d23m07
nomonetario$cuip_nm[(decena==2 & is.na(decena)!=TRUE)]=nomonetario$cuip_nm[(decena==2 & is.na(decena)!=TRUE)]/d23m07
nomonetario$cuip_nm[(decena==3 & is.na(decena)!=TRUE)]=nomonetario$cuip_nm[(decena==3 & is.na(decena)!=TRUE)]/d23m08
nomonetario$cuip_nm[(decena==4 & is.na(decena)!=TRUE)]=nomonetario$cuip_nm[(decena==4 & is.na(decena)!=TRUE)]/d23m08
nomonetario$cuip_nm[(decena==5 & is.na(decena)!=TRUE)]=nomonetario$cuip_nm[(decena==5 & is.na(decena)!=TRUE)]/d23m08
nomonetario$cuip_nm[(decena==6 & is.na(decena)!=TRUE)]=nomonetario$cuip_nm[(decena==6 & is.na(decena)!=TRUE)]/d23m09
nomonetario$cuip_nm[(decena==7 & is.na(decena)!=TRUE)]=nomonetario$cuip_nm[(decena==7 & is.na(decena)!=TRUE)]/d23m09
nomonetario$cuip_nm[(decena==8 & is.na(decena)!=TRUE)]=nomonetario$cuip_nm[(decena==8 & is.na(decena)!=TRUE)]/d23m09
nomonetario$cuip_nm[(decena==9 & is.na(decena)!=TRUE)]=nomonetario$cuip_nm[(decena==9 & is.na(decena)!=TRUE)]/d23m10
nomonetario$cuip_nm[(decena==0 & is.na(decena)!=TRUE)]=nomonetario$cuip_nm[(decena==0 & is.na(decena)!=TRUE)]/d23m10
#Gasto en Accesorios personales deflactado (trimestral)
for(i in 123:131){
gas_accper=1000+i
string=paste("H", substr(as.character(gas_accper), 2, 4),  sep = "")
nomonetario$accp_nm[(clave==string & is.na(clave)!=TRUE)]=nomonetario$gasnomon[(clave==string & is.na(clave)!=TRUE)]
}
nomonetario$accp_nm[(clave=="H133" & is.na(clave)!=TRUE)]=nomonetario$gasnomon[(clave=="H133" & is.na(clave)!=TRUE)]
nomonetario$accp_nm[(decena==1 & is.na(decena)!=TRUE)]=nomonetario$accp_nm[(decena==1 & is.na(decena)!=TRUE)]/d23t05
nomonetario$accp_nm[(decena==2 & is.na(decena)!=TRUE)]=nomonetario$accp_nm[(decena==2 & is.na(decena)!=TRUE)]/d23t05
nomonetario$accp_nm[(decena==3 & is.na(decena)!=TRUE)]=nomonetario$accp_nm[(decena==3 & is.na(decena)!=TRUE)]/d23t06
nomonetario$accp_nm[(decena==4 & is.na(decena)!=TRUE)]=nomonetario$accp_nm[(decena==4 & is.na(decena)!=TRUE)]/d23t06
nomonetario$accp_nm[(decena==5 & is.na(decena)!=TRUE)]=nomonetario$accp_nm[(decena==5 & is.na(decena)!=TRUE)]/d23t06
nomonetario$accp_nm[(decena==6 & is.na(decena)!=TRUE)]=nomonetario$accp_nm[(decena==6 & is.na(decena)!=TRUE)]/d23t07
nomonetario$accp_nm[(decena==7 & is.na(decena)!=TRUE)]=nomonetario$accp_nm[(decena==7 & is.na(decena)!=TRUE)]/d23t07
nomonetario$accp_nm[(decena==8 & is.na(decena)!=TRUE)]=nomonetario$accp_nm[(decena==8 & is.na(decena)!=TRUE)]/d23t07
nomonetario$accp_nm[(decena==9 & is.na(decena)!=TRUE)]=nomonetario$accp_nm[(decena==9 & is.na(decena)!=TRUE)]/d23t08
nomonetario$accp_nm[(decena==0 & is.na(decena)!=TRUE)]=nomonetario$accp_nm[(decena==0 & is.na(decena)!=TRUE)]/d23t08
#Gasto en Otros gastos y transferencias deflactado (semestral)
for(i in 1:2){
gas_otro=1000+i
string=paste("N", substr(as.character(gas_otro), 2, 4),  sep = "")
nomonetario$otr_nm[(clave==string & is.na(clave)!=TRUE)]=nomonetario$gasnomon[(clave==string & is.na(clave)!=TRUE)]
}
for(i in 6:16){
gas_otro=1000+i
string=paste("N", substr(as.character(gas_otro), 2, 4),  sep = "")
nomonetario$otr_nm[(clave==string & is.na(clave)!=TRUE)]=nomonetario$gasnomon[(clave==string & is.na(clave)!=TRUE)]
}
for(i in 901:915){
gas_otro=1000+i
string=paste("T", substr(as.character(gas_otro), 2, 4),  sep = "")
nomonetario$otr_nm[(clave==string & is.na(clave)!=TRUE)]=nomonetario$gasnomon[(clave==string & is.na(clave)!=TRUE)]
}
nomonetario$otr_nm[(clave=="R012" & is.na(clave)!=TRUE)]=nomonetario$gasnomon[(clave=="R012" & is.na(clave)!=TRUE)]
nomonetario$otr_nm[(decena==1 & is.na(decena)!=TRUE)]=nomonetario$otr_nm[(decena==1 & is.na(decena)!=TRUE)]/dINPCs02
nomonetario$otr_nm[(decena==2 & is.na(decena)!=TRUE)]=nomonetario$otr_nm[(decena==2 & is.na(decena)!=TRUE)]/dINPCs02
nomonetario$otr_nm[(decena==3 & is.na(decena)!=TRUE)]=nomonetario$otr_nm[(decena==3 & is.na(decena)!=TRUE)]/dINPCs03
nomonetario$otr_nm[(decena==4 & is.na(decena)!=TRUE)]=nomonetario$otr_nm[(decena==4 & is.na(decena)!=TRUE)]/dINPCs03
nomonetario$otr_nm[(decena==5 & is.na(decena)!=TRUE)]=nomonetario$otr_nm[(decena==5 & is.na(decena)!=TRUE)]/dINPCs03
nomonetario$otr_nm[(decena==6 & is.na(decena)!=TRUE)]=nomonetario$otr_nm[(decena==6 & is.na(decena)!=TRUE)]/dINPCs04
nomonetario$otr_nm[(decena==7 & is.na(decena)!=TRUE)]=nomonetario$otr_nm[(decena==7 & is.na(decena)!=TRUE)]/dINPCs04
nomonetario$otr_nm[(decena==8 & is.na(decena)!=TRUE)]=nomonetario$otr_nm[(decena==8 & is.na(decena)!=TRUE)]/dINPCs04
nomonetario$otr_nm[(decena==9 & is.na(decena)!=TRUE)]=nomonetario$otr_nm[(decena==9 & is.na(decena)!=TRUE)]/dINPCs05
nomonetario$otr_nm[(decena==0 & is.na(decena)!=TRUE)]=nomonetario$otr_nm[(decena==0 & is.na(decena)!=TRUE)]/dINPCs05
#Gasto en Regalos Otorgados deflactado
for(i in 901:915){
gas_reg=1000+i
string=paste("T", substr(as.character(gas_reg), 2, 4),  sep = "")
nomonetario$reda_nm[(clave==string & is.na(clave)!=TRUE)]=nomonetario$gasnomon[(clave==string & is.na(clave)!=TRUE)]
}
nomonetario$reda_nm[(clave=="N013" & is.na(clave)!=TRUE)]=nomonetario$gasnomon[(clave=="N013" & is.na(clave)!=TRUE)]
nomonetario$reda_nm[(decena==1 & is.na(decena)!=TRUE)]=nomonetario$reda_nm[(decena==1 & is.na(decena)!=TRUE)]/dINPCs02
nomonetario$reda_nm[(decena==2 & is.na(decena)!=TRUE)]=nomonetario$reda_nm[(decena==2 & is.na(decena)!=TRUE)]/dINPCs02
nomonetario$reda_nm[(decena==3 & is.na(decena)!=TRUE)]=nomonetario$reda_nm[(decena==3 & is.na(decena)!=TRUE)]/dINPCs03
nomonetario$reda_nm[(decena==4 & is.na(decena)!=TRUE)]=nomonetario$reda_nm[(decena==4 & is.na(decena)!=TRUE)]/dINPCs03
nomonetario$reda_nm[(decena==5 & is.na(decena)!=TRUE)]=nomonetario$reda_nm[(decena==5 & is.na(decena)!=TRUE)]/dINPCs03
nomonetario$reda_nm[(decena==6 & is.na(decena)!=TRUE)]=nomonetario$reda_nm[(decena==6 & is.na(decena)!=TRUE)]/dINPCs04
nomonetario$reda_nm[(decena==7 & is.na(decena)!=TRUE)]=nomonetario$reda_nm[(decena==7 & is.na(decena)!=TRUE)]/dINPCs04
nomonetario$reda_nm[(decena==8 & is.na(decena)!=TRUE)]=nomonetario$reda_nm[(decena==8 & is.na(decena)!=TRUE)]/dINPCs04
nomonetario$reda_nm[(decena==9 & is.na(decena)!=TRUE)]=nomonetario$reda_nm[(decena==9 & is.na(decena)!=TRUE)]/dINPCs05
nomonetario$reda_nm[(decena==0 & is.na(decena)!=TRUE)]=nomonetario$reda_nm[(decena==0 & is.na(decena)!=TRUE)]/dINPCs05
detach(nomonetario)
mean(nomonetario$ali_nm,na.rm=TRUE)
mean(nomonetario$alta_nm,na.rm=TRUE)
mean(nomonetario$veca_nm,na.rm=TRUE)
mean(nomonetario$viv_nm,na.rm=TRUE)
mean(nomonetario$lim_nm,na.rm=TRUE)
mean(nomonetario$cris_nm,na.rm=TRUE)
mean(nomonetario$ens_nm,na.rm=TRUE)
mean(nomonetario$sal_nm,na.rm=TRUE)
mean(nomonetario$tpub_nm,na.rm=TRUE)
mean(nomonetario$tfor_nm,na.rm=TRUE)
mean(nomonetario$com_nm,na.rm=TRUE)
mean(nomonetario$edre_nm,na.rm=TRUE)
mean(nomonetario$edba_nm,na.rm=TRUE)
mean(nomonetario$cuip_nm,na.rm=TRUE)
mean(nomonetario$accp_nm,na.rm=TRUE)
mean(nomonetario$otr_nm,na.rm=TRUE)
mean(nomonetario$reda_nm,na.rm=TRUE)
indexesp=(nomonetario$esp==1 & is.na(nomonetario$esp)!=TRUE)
nomonetarioesp=nomonetario[indexesp,]
#Construcción de la base de pagos en especie a partir de la base de gasto no monetario
attach(nomonetarioesp)
nomonetarioesp2=aggregate(x=list(ali_nm, alta_nm,  veca_nm,  viv_nm,  lim_nm, cris_nm, ens_nm, sal_nm,  tpub_nm, tfor_nm, com_nm, edre_nm, edba_nm, cuip_nm, accp_nm, otr_nm, reda_nm), by=list( folioviv, foliohog),  FUN=sum, na.rm=TRUE)
detach(nomonetarioesp)
names(nomonetarioesp2 )[1:19] <- c( "folioviv", "foliohog","ali_nme", "alta_nme", "veca_nme", "viv_nme", "lim_nme", "cris_nme", "ens_nme", "sal_nme", "tpub_nme", "tfor_nme", "com_nme", "edre_nme", "edba_nme", "cuip_nme", "accp_nme", "otr_nme", "reda_nme")
nomonetarioesp2 <- orderBy(~+folioviv+foliohog, data=nomonetarioesp2)
indexreg=(nomonetario$reg==1 & is.na(nomonetario$reg)!=TRUE)
nomonetarioreg=nomonetario[indexreg,]
#Construcción de base de regalos a partir de la base no monetaria
attach(nomonetarioreg)
nomonetarioreg2=aggregate(x=list(ali_nm, alta_nm,  veca_nm,  viv_nm,  lim_nm, cris_nm, ens_nm, sal_nm,  tpub_nm, tfor_nm, com_nm, edre_nm, edba_nm, cuip_nm, accp_nm, otr_nm, reda_nm), by=list( folioviv, foliohog),  FUN=sum, na.rm=TRUE)
detach(nomonetarioreg)
names(nomonetarioreg2 )[1:19] <- c( "folioviv", "foliohog","ali_nmr", "alta_nmr", "veca_nmr", "viv_nmr", "lim_nmr", "cris_nmr", "ens_nmr", "sal_nmr", "tpub_nmr", "tfor_nmr", "com_nmr", "edre_nmr", "edba_nmr", "cuip_nmr", "accp_nmr", "otr_nmr", "reda_nmr")
nomonetarioreg2 <- orderBy(~+folioviv+foliohog, data=nomonetarioreg2)
#Construcción del ingreso corriente total
concentrado <- read.dta("ENIGH/concentradohogar.dta")
concentrado=concentrado[, c(   "folioviv" ,  "foliohog"  , "factor" ,  "tam_loc" , "tot_integ")]
concentrado <- orderBy(~+folioviv+foliohog, data=concentrado)
concentrado1 <- merge(concentrado,ingresos2,by.x=c( "folioviv", "foliohog"),all = TRUE)
concentrado1 <- orderBy(~+folioviv+foliohog, data=concentrado1)
concentrado2 <- merge(concentrado1,nomonetarioesp2,by.x=c( "folioviv", "foliohog"),all = TRUE)
concentrado2 <- orderBy(~+folioviv+foliohog, data=concentrado2)
concentrado3 <- merge(concentrado2,nomonetarioreg2,by.x=c( "folioviv", "foliohog"),all = TRUE)
concentrado3 <- orderBy(~+folioviv+foliohog, data=concentrado3)
concentrado3$rururb=0
concentrado3$rururb[concentrado3$tam_loc=="4"]=1
concentrado3$pago_esp=rowSums(data.frame(concentrado3$ali_nme, concentrado3$alta_nme,  concentrado3$veca_nme,  concentrado3$viv_nme,  concentrado3$lim_nme, concentrado3$cris_nme, concentrado3$ens_nme, concentrado3$sal_nme,  concentrado3$tpub_nme, concentrado3$tfor_nme, concentrado3$com_nme, concentrado3$edre_nme, concentrado3$cuip_nme, concentrado3$accp_nme, concentrado3$otr_nme), na.rm = TRUE)
concentrado3$reg_esp=rowSums(data.frame(concentrado3$ali_nmr, concentrado3$alta_nmr,  concentrado3$veca_nmr,  concentrado3$viv_nmr,  concentrado3$lim_nmr, concentrado3$cris_nmr, concentrado3$ens_nmr, concentrado3$sal_nmr,  concentrado3$tpub_nmr, concentrado3$tfor_nmr, concentrado3$com_nmr, concentrado3$edre_nmr, concentrado3$cuip_nmr, concentrado3$accp_nmr, concentrado3$otr_nmr), na.rm = TRUE)
concentrado3$nomon=rowSums(data.frame(concentrado3$pago_esp, concentrado3$reg_esp ), na.rm = TRUE)
concentrado3$ict=rowSums(data.frame(concentrado3$ing_mon, concentrado3$nomon ), na.rm = TRUE)
concentrado3 <- orderBy(~+folioviv+foliohog, data=concentrado3)
mean(concentrado3$pago_esp)
mean(concentrado3$reg_esp)
mean(concentrado3$nomon)
mean(concentrado3$ict)
write.csv(concentrado3, 'Bases generadas/ingresotot18.csv', row.names = FALSE)
write.dta(concentrado3, 'Bases generadas/ingresotot18.dta')
#Construcción del tamaño de hogar con economías de escala
#y escalas de equivalencia
rm(list = ls())
poblacion1 <- read.dta("ENIGH/poblacion.dta")
#Población objeto: no se incluye a huéspedes ni trabajadores domésticos
poblacion2<-as.numeric(poblacion1$parentesco)
index=((poblacion2>=400 & poblacion2<500)| (poblacion2>=700 & poblacion2 <800))
index=(index==FALSE)
poblacion=poblacion1[index,]
poblacion$ind=1
attach(poblacion)
poblacion2=aggregate(x=list(ind), by=list( folioviv, foliohog),  FUN=sum, na.rm=TRUE)
detach(poblacion)
names(poblacion2)[1:3] <- c( "folioviv",  "foliohog", "tot_ind"  )
poblacion= merge(poblacion, poblacion2, by=c( "folioviv",  "foliohog"), all.x = TRUE)
#Escalas de equivalencia
attach(poblacion)
poblacion$n_05=NA
poblacion$n_05[edad>=0 & edad<=5]=1
poblacion$n_05[(edad>5 & is.na(edad)==FALSE)]=0
poblacion$n_6_12=NA
poblacion$n_6_12[edad>=6 & edad<=12]=1
poblacion$n_6_12[((edad>12 | edad<6) & is.na(edad)==FALSE)]=0
poblacion$n_13_18=NA
poblacion$n_13_18[edad>=13 & edad<=18]=1
poblacion$n_13_18[((edad>18 | edad<13) & is.na(edad)==FALSE)]=0
poblacion$n_19=NA
poblacion$n_19[edad>=19]=1
poblacion$n_19[((edad<19) & is.na(edad)==FALSE)]=0
detach(poblacion)
attach(poblacion)
poblacion$tamhogesc=n_05*.7031
poblacion$tamhogesc[n_6_12==1 & is.na(n_6_12)==FALSE]=n_6_12[n_6_12==1 & is.na(n_6_12)==FALSE]*.7382
poblacion$tamhogesc[n_13_18==1 & is.na(n_13_18)==FALSE]=n_13_18[n_13_18==1 & is.na(n_13_18)==FALSE]*.7057
poblacion$tamhogesc[n_19==1 & is.na(n_19)==FALSE]=n_19[n_19==1 & is.na(n_19)==FALSE]*.9945
poblacion$tamhogesc[tot_ind==1 & is.na(tot_ind)==FALSE]=1
detach(poblacion)
attach(poblacion)
poblacion2=aggregate(x=list(tamhogesc), by=list( folioviv, foliohog),  FUN=sum, na.rm=TRUE)
detach(poblacion)
names(poblacion2 )[1:3] <- c( "folioviv", "foliohog","tamhogesc")
poblacion2 <- orderBy(~+folioviv+foliohog, data=poblacion2)
write.csv(poblacion2, 'Bases generadas/tamhogesc18.csv', row.names = FALSE)
write.dta(poblacion2, 'Bases generadas/tamhogesc18.dta')
#Bienestar por ingresos
ingresos=read.dta('Bases generadas/ingresotot18.dta')
ingresos2= merge(ingresos, poblacion2, by=c( "folioviv",  "foliohog"), all = TRUE)
ingresos2 <- orderBy(~+folioviv+foliohog, data=ingresos2)
ingresos2$ictpc= as.numeric(ingresos2$ict)/ingresos2$tamhogesc
ingresos2$factorp= ingresos2$factor*ingresos2$tot_integ
lp1_urb = 1544.04
lp1_rur = 1164.75
#Se identifica a los hogares bajo LP1
attach(ingresos2)
ingresos2$plb_m=NA
ingresos2$plb_m[ictpc<lp1_urb & rururb==0]=1
ingresos2$plb_m[ictpc>=lp1_urb & rururb==0 ]=0
ingresos2$plb_m[ictpc<lp1_rur & rururb==1]=1
ingresos2$plb_m[ictpc>=lp1_rur & rururb==1]=0
table(ingresos2$plb_m)
detach(ingresos2)
#Bienestar
lp2_urb = 3325.40
lp2_rur = 2316.57
attach(ingresos2)
ingresos2$plb=NA
ingresos2$plb[(ictpc<lp2_urb & rururb==0)]=1
ingresos2$plb[(ictpc>=lp2_urb & rururb==0) ]=0
ingresos2$plb[(ictpc<lp2_rur & rururb==1)]=1
ingresos2$plb[(ictpc>=lp2_rur & rururb==1)]=0
table(ingresos2$plb)
detach(ingresos2)
attach(ingresos2)
ingresos2=ingresos2[, c( "folioviv", "foliohog", "factor", "tam_loc", "rururb", "tamhogesc", "ict", "ictpc", "plb_m", "plb")]
ingresos2 <- orderBy(~+folioviv+foliohog, data=ingresos2)
write.csv(ingresos2, 'Bases generadas/p_ingresos18.csv', row.names = FALSE)
write.dta(ingresos2, 'Bases generadas/p_ingresos18.dta')
detach(ingresos2)
rm(list = ls())
rezedu=read.dta('Bases generadas/ic_rezedu18.csv',header=TRUE, sep=",", na.strings="NA", dec=".")
?apply
rm(list = ls())
rezedu=read.dta('Bases generadas/ic_rezedu18.dta')
salud=read.dta('Bases generadas/ic_asalud18.dta')
base_pobreza= merge(rezedu, salud,by.x=c( "folioviv", "foliohog", "numren" ), all.x = TRUE)
segsoc=read.dta('Bases generadas/ic_segsoc18.dta')
base_pobreza= merge(base_pobreza, segsoc, by.x=c( "folioviv", "foliohog", "numren" ), all.x = TRUE)
ingresos=read.dta('Bases generadas/p_ingresos18.dta')
base_pobreza= merge(base_pobreza, ingresos, by.x=c( "folioviv", "foliohog"), all.x = TRUE)
cev=read.dta('Bases generadas/ic_cev18.dta')
base_pobreza= merge(base_pobreza, cev, by.x=c( "folioviv", "foliohog"), all.x = TRUE)
sbv=read.dta('Bases generadas/ic_sbv18.dta')
base_pobreza= merge(base_pobreza, sbv, by.x=c( "folioviv"), all.x = TRUE)
ali=read.dta('Bases generadas/ic_ali18.dta')
base_pobreza= merge(base_pobreza, ali, by.x=c( "folioviv", "foliohog"), all.x = TRUE)
#######################################################
#Identificador de la entidad federativa
base_pobreza$ent=substr(10000000000 + base_pobreza$folioviv,2,3)
class(base_pobreza$folioviv)
base_pobreza$folioviv[1:3]
rm(list = ls())
rezedu=read.dta('Bases generadas/ic_rezedu18.dta')
salud=read.dta('Bases generadas/ic_asalud18.dta')
base_pobreza= merge(rezedu, salud,by.x=c( "folioviv", "foliohog", "numren" ), all.x = TRUE)
segsoc=read.dta('Bases generadas/ic_segsoc18.dta')
base_pobreza= merge(base_pobreza, segsoc, by.x=c( "folioviv", "foliohog", "numren" ), all.x = TRUE)
ingresos=read.dta('Bases generadas/p_ingresos18.dta')
base_pobreza= merge(base_pobreza, ingresos, by.x=c( "folioviv", "foliohog"), all.x = TRUE)
cev=read.dta('Bases generadas/ic_cev18.dta')
base_pobreza= merge(base_pobreza, cev, by.x=c( "folioviv", "foliohog"), all.x = TRUE)
sbv=read.dta('Bases generadas/ic_sbv18.dta')
base_pobreza= merge(base_pobreza, sbv, by.x=c( "folioviv"), all.x = TRUE)
ali=read.dta('Bases generadas/ic_ali18.dta')
base_pobreza= merge(base_pobreza, ali, by.x=c( "folioviv", "foliohog"), all.x = TRUE)
#######################################################
#Identificador de la entidad federativa
base_pobreza$ent=substr(10000000000 +as.numeric(base_pobreza$folioviv),2,3)
#Índice de Privación Social
base_pobreza$i_privacion=rowSums(data.frame(base_pobreza$ic_rezedu, base_pobreza$ic_asalud, base_pobreza$ic_segsoc, base_pobreza$ic_cv, base_pobreza$ic_sbv, base_pobreza$ic_ali_nc), na.rm = TRUE)
base_pobreza$i_privacion[(is.na(base_pobreza$ic_rezedu)==TRUE | is.na(base_pobreza$ic_asalud)==TRUE | is.na(base_pobreza$ic_segsoc)==TRUE | is.na(base_pobreza$ic_cv)==TRUE | is.na(base_pobreza$ic_sbv)==TRUE | is.na(base_pobreza$ic_ali_nc)==TRUE)]=NA
table(base_pobreza$i_privacion)
#Pobreza
base_pobreza$pobreza[((base_pobreza$i_privacion>=1 & is.na(base_pobreza$i_privacion)!=TRUE) & base_pobreza$plb==1)]=1
base_pobreza$pobreza[(base_pobreza$plb==0 | base_pobreza$i_privacion==0) & (is.na(base_pobreza$plb)!=TRUE & is.na(base_pobreza$i_privacion)!=TRUE)]=0
table(base_pobreza$pobreza)
#Pobreza extrema
base_pobreza$pobreza_e[(base_pobreza$i_privacion>=3 & is.na(base_pobreza$i_privacion)!=TRUE) & base_pobreza$plb_m==1]=1
base_pobreza$pobreza_e[(base_pobreza$plb_m==0 | base_pobreza$i_privacion<3) & (is.na(base_pobreza$plb_m)!=TRUE & is.na(base_pobreza$i_privacion)!=TRUE)]=0
table(base_pobreza$pobreza_e)
#Pobreza moderada
base_pobreza$pobreza_m[(base_pobreza$pobreza==1 & base_pobreza$pobreza_e==0)]=1
base_pobreza$pobreza_m[ base_pobreza$pobreza==0 | (base_pobreza$pobreza==1 & base_pobreza$pobreza_e==1)]=0
table(base_pobreza$pobreza_m)
#Población vulnerable
#Vulnerables por carencias
base_pobreza$vul_car[((base_pobreza$i_privacion>=1 & is.na(base_pobreza$i_privacion)!=TRUE) & base_pobreza$plb==0)]=1
base_pobreza$vul_car[((base_pobreza$plb==0 & base_pobreza$i_privacion==0) | base_pobreza$plb==1)]=0
base_pobreza$vul_car[is.na(base_pobreza$pobreza)==TRUE]=NA
table(base_pobreza$vul_car)
#Vulnerables por ingresos
base_pobreza$vul_ing[(base_pobreza$i_privacion==0 & base_pobreza$plb==1)]=1
base_pobreza$vul_ing[base_pobreza$plb==0 | (base_pobreza$plb==1 & base_pobreza$i_privacion>=1) ]=0
base_pobreza$vul_ing[is.na(base_pobreza$pobreza)==TRUE]=NA
table(base_pobreza$vul_ing)
#Población no pobre y no vulnerable
base_pobreza$no_pobv[(base_pobreza$i_privacion==0 & base_pobreza$plb==0)]=1
base_pobreza$no_pobv[base_pobreza$plb==1 | (base_pobreza$plb==0 & base_pobreza$i_privacion>=1) ]=0
base_pobreza$no_pobv[is.na(base_pobreza$pobreza)==TRUE]=NA
table(base_pobreza$no_pobv)
#Población con carencias sociales#
base_pobreza$carencias[base_pobreza$i_privacion>=1]=1
base_pobreza$carencias[base_pobreza$i_privacion==0]=0
base_pobreza$carencias[is.na(base_pobreza$pobreza)==TRUE]=NA
table(base_pobreza$carencias)
base_pobreza$carencias3[base_pobreza$i_privacion>=3]=1
base_pobreza$carencias3[base_pobreza$i_privacion<=2]=0
base_pobreza$carencias3[is.na(base_pobreza$pobreza)==TRUE]=NA
table(base_pobreza$carencias3)
#Cuadrantes
base_pobreza$cuadrantes=NA
base_pobreza$cuadrantes[(base_pobreza$i_privacion>=1 & is.na(base_pobreza$i_privacion)!=TRUE) & base_pobreza$plb==1]=1
base_pobreza$cuadrantes[((base_pobreza$i_privacion>=1 & is.na(base_pobreza$i_privacion)!=TRUE) & base_pobreza$plb==0)]=2
base_pobreza$cuadrantes[base_pobreza$i_privacion==0 & base_pobreza$plb==1]=3
base_pobreza$cuadrantes[base_pobreza$i_privacion==0 & base_pobreza$plb==0]=4
table(base_pobreza$cuadrantes)
base_pobreza <- orderBy(~+folioviv+foliohog, data=base_pobreza)
base_pobreza=base_pobreza[, c(	"folioviv",	"foliohog",	"numren",	"edad",	"anac_e",	"inas_esc",	"antec_esc",	"niv_ed",
"ic_rezedu",	"hli",	"pobi",	"sexo",	"discap",	"ic_asalud",	"tipo_trab1",	"tipo_trab2",	"inclab1",
"inclab2",	"aforlab1",	"aforlab2",	"smlab1",	"smlab2",	"smcv",	"aforecv",	"pea",	"jub",	"ss_dir",
"par",	"jef_ss",	"cony_ss",	"hijo_ss",	"s_salud",	"pam",	"ic_segsoc",	"factor",	"tam_loc",
"rururb",	"tamhogesc",	"ict",	"ictpc",	"plb_m",	"plb",	"tot_resid",	"num_cuarto",	"icv_mat_pisos",
"icv_mat_techos",	"icv_mat_muros",	"icv_hac",	"ic_cv",	"sb_agua",	"sb_dren",	"sb_luz",	"isb_combus",
"ic_sbv",	"id_men",	"ia_1ad",	"ia_2ad",	"ia_3ad",	"ia_4ad",	"ia_5ad",	"ia_6ad",	"ia_7men",	"ia_8men",
"ia_9men",	"ia_10men",	"ia_11men",	"ia_12men",	"tot_iaad",	"tot_iamen",	"ins_ali",	"ic_ali_nc",	"ent",
"i_privacion",	"pobreza",	"pobreza_e",	"pobreza_m",	"vul_car",	"vul_ing",	"no_pobv",	"carencias",
"carencias3",	"cuadrantes")]
write.csv(base_pobreza, 'Bases generadas/pobreza_18.csv', row.names = FALSE)
write.dta(base_pobreza, 'Bases generadas/pobreza_18.dta')
b<-base_pobreza[,74:81]
a=matrix(data=NA, ncol=8, nrow=length(b[,1]))
for(n in 1:8) {
a[,n]<-b[,n]*base_pobreza$factor
}
mean2=function(varname) {
porc<-weighted.mean(varname, base_pobreza$factor,na.rm=T)*100
}
resultados=matrix(data=c(apply(b,2,mean2),apply(a,2,sum,na.rm=T)), ncol=2, nrow=8, byrow=F)
nombres=c("pobreza","pobreza_e","pobreza_m","vul_car","vul_ing","no_pobv","carencias","carencias3")
resultados
par(las=2)
barplot(resultados[,1], main="Porcentaje de indicadores de pobreza", names.arg=c("pobreza","pobreza_e","pobreza_m","vul_car","vul_ing","no_pobv","carencias","carencias3"), cex.names=0.6, horiz=T)
beepr::beep(10)
display(resultados,digits=10)
print(resultados,digits=10)
print(resultados,digits=15)
resultados
names(b)
names(base_pobreza)[74:81]
which(names(base_pobreza)) %in% c("pobreza","pobreza_e","pobreza_m","vul_car","vul_ing","no_pobv","carencias","carencias3","ic_rezedu","ic_asalud","ic_segsoc","ic_cv","ic_sbv","ic_ali_nc","plb_m","plb")
which(names(base_pobreza) %in% c("pobreza","pobreza_e","pobreza_m","vul_car","vul_ing","no_pobv","carencias","carencias3","ic_rezedu","ic_asalud","ic_segsoc","ic_cv","ic_sbv","ic_ali_nc","plb_m","plb"))
which(names(base_pobreza) %in% ("pobreza","pobreza_e","pobreza_m","vul_car","vul_ing","no_pobv","carencias","carencias3"))
which(names(base_pobreza) %in% c("pobreza","pobreza_e","pobreza_m","vul_car","vul_ing","no_pobv","carencias","carencias3"))
which(names(base_pobreza) %in% c("pobreza","pobreza_e","pobreza_m","vul_car","vul_ing","no_pobv","carencias","carencias3","ic_rezedu","ic_asalud","ic_segsoc","ic_cv","ic_sbv","ic_ali_nc","plb_m","plb"))
aux <- which(names(base_pobreza) %in% c("pobreza","pobreza_e","pobreza_m","vul_car","vul_ing","no_pobv","carencias","carencias3","ic_rezedu","ic_asalud","ic_segsoc","ic_cv","ic_sbv","ic_ali_nc","plb_m","plb"))
aux <- which(names(base_pobreza) %in% c("pobreza","pobreza_e","pobreza_m","vul_car","vul_ing","no_pobv","carencias","carencias3","ic_rezedu","ic_asalud","ic_segsoc","ic_cv","ic_sbv","ic_ali_nc","plb_m","plb"))
b<-base_pobreza[,aux]
a=matrix(data=NA, ncol=8, nrow=length(b[,1]))
for(n in 1:8) {
a[,n]<-b[,n]*base_pobreza$factor
}
mean2=function(varname) {
porc<-weighted.mean(varname, base_pobreza$factor,na.rm=T)*100
}
resultados=matrix(data=c(apply(b,2,mean2),apply(a,2,sum,na.rm=T)), ncol=2, nrow=8, byrow=F)
nombres=names(base_pobreza)[aux]
resultados
par(las=2)
barplot(resultados[,1], main="Porcentaje de indicadores de pobreza", names.arg=c("pobreza","pobreza_e","pobreza_m","vul_car","vul_ing","no_pobv","carencias","carencias3"), cex.names=0.6, horiz=T)
beepr::beep(10)
aux <- which(names(base_pobreza) %in% c("pobreza","pobreza_e","pobreza_m","vul_car","vul_ing","no_pobv","carencias","carencias3","ic_rezedu","ic_asalud","ic_segsoc","ic_cv","ic_sbv","ic_ali_nc","plb_m","plb"))
b<-base_pobreza[,aux]
a=matrix(data=NA, ncol=8, nrow=length(b[,1]))
for(n in 1:16) {
a[,n]<-b[,n]*base_pobreza$factor
}
mean2=function(varname) {
porc<-weighted.mean(varname, base_pobreza$factor,na.rm=T)*100
}
resultados=matrix(data=c(apply(b,2,mean2),apply(a,2,sum,na.rm=T)), ncol=2, nrow=8, byrow=F)
nombres=names(base_pobreza)[aux]
resultados
par(las=2)
barplot(resultados[,1], main="Porcentaje de indicadores de pobreza", names.arg=c("pobreza","pobreza_e","pobreza_m","vul_car","vul_ing","no_pobv","carencias","carencias3"), cex.names=0.6, horiz=T)
beepr::beep(10)
aux <- which(names(base_pobreza) %in% c("pobreza","pobreza_e","pobreza_m","vul_car","vul_ing","no_pobv","carencias","carencias3","ic_rezedu","ic_asalud","ic_segsoc","ic_cv","ic_sbv","ic_ali_nc","plb_m","plb"))
b<-base_pobreza[,aux]
a=matrix(data=NA, ncol=16, nrow=length(b[,1]))
for(n in 1:16) {
a[,n]<-b[,n]*base_pobreza$factor
}
mean2=function(varname) {
porc<-weighted.mean(varname, base_pobreza$factor,na.rm=T)*100
}
resultados=matrix(data=c(apply(b,2,mean2),apply(a,2,sum,na.rm=T)), ncol=2, nrow=16, byrow=F)
nombres=names(base_pobreza)[aux]
resultados
par(las=2)
barplot(resultados[,1], main="Porcentaje de indicadores de pobreza", names.arg=cwhich(names(base_pobreza) %in% c("pobreza","pobreza_e","pobreza_m","vul_car","vul_ing","no_pobv","carencias","carencias3","ic_rezedu","ic_asalud","ic_segsoc","ic_cv","ic_sbv","ic_ali_nc","plb_m","plb"),
cex.names=0.6, horiz=T)
beepr::beep(10)
aux <- which(names(base_pobreza) %in% c("pobreza","pobreza_e","pobreza_m","vul_car","vul_ing","no_pobv","carencias","carencias3","ic_rezedu","ic_asalud","ic_segsoc","ic_cv","ic_sbv","ic_ali_nc","plb_m","plb"))
b<-base_pobreza[,aux]
a=matrix(data=NA, ncol=16, nrow=length(b[,1]))
for(n in 1:16) {
a[,n]<-b[,n]*base_pobreza$factor
}
mean2=function(varname) {
porc<-weighted.mean(varname, base_pobreza$factor,na.rm=T)*100
}
resultados=matrix(data=c(apply(b,2,mean2),apply(a,2,sum,na.rm=T)), ncol=2, nrow=16, byrow=F)
nombres=names(base_pobreza)[aux]
resultados
par(las=2)
barplot(resultados[,1], main="Porcentaje de indicadores de pobreza", names.arg=cwhich(names(base_pobreza) %in% c("pobreza","pobreza_e","pobreza_m","vul_car","vul_ing","no_pobv","carencias","carencias3","ic_rezedu","ic_asalud","ic_segsoc","ic_cv","ic_sbv","ic_ali_nc","plb_m","plb")),
cex.names=0.6, horiz=T)
beepr::beep(10)
aux <- which(names(base_pobreza) %in% c("pobreza","pobreza_e","pobreza_m","vul_car","vul_ing","no_pobv","carencias","carencias3","ic_rezedu","ic_asalud","ic_segsoc","ic_cv","ic_sbv","ic_ali_nc","plb_m","plb"))
b<-base_pobreza[,aux]
a=matrix(data=NA, ncol=16, nrow=length(b[,1]))
for(n in 1:16) {
a[,n]<-b[,n]*base_pobreza$factor
}
mean2=function(varname) {
porc<-weighted.mean(varname, base_pobreza$factor,na.rm=T)*100
}
resultados=matrix(data=c(apply(b,2,mean2),apply(a,2,sum,na.rm=T)), ncol=2, nrow=16, byrow=F)
nombres=names(base_pobreza)[aux]
resultados
par(las=2)
barplot(resultados[,1], main="Porcentaje de indicadores de pobreza",
names.arg=c("pobreza","pobreza_e","pobreza_m","vul_car","vul_ing","no_pobv","carencias","carencias3","ic_rezedu","ic_asalud","ic_segsoc","ic_cv","ic_sbv","ic_ali_nc","plb_m","plb"),
cex.names=0.6, horiz=T)
beepr::beep(10)
class(resultados)
resultados <- t(resultados)
resultados
rownames(resultados)
resultados <- t(resultados)
resultados
rownames(resultados) <- c("pobreza","pobreza_e","pobreza_m","vul_car","vul_ing","no_pobv","carencias","carencias3","ic_rezedu","ic_asalud","ic_segsoc","ic_cv","ic_sbv","ic_ali_nc","plb_m","plb")
resultados
aux <- which(names(base_pobreza) %in% c("pobreza","pobreza_e","pobreza_m","vul_car","vul_ing","no_pobv","carencias","carencias3","ic_rezedu","ic_asalud","ic_segsoc","ic_cv","ic_sbv","ic_ali_nc","plb_m","plb"))
b<-base_pobreza[,aux]
a=matrix(data=NA, ncol=16, nrow=length(b[,1]))
for(n in 1:16) {
a[,n]<-b[,n]*base_pobreza$factor
}
mean2=function(varname) {
porc<-weighted.mean(varname, base_pobreza$factor,na.rm=T)*100
}
resultados=matrix(data=c(apply(b,2,mean2),apply(a,2,sum,na.rm=T)), ncol=2, nrow=16, byrow=F)
nombres=names(base_pobreza)[aux]
rownames(resultados) <- nombres
resultados
par(las=2)
barplot(resultados[,1], main="Porcentaje de indicadores de pobreza",
names.arg=nombres,
cex.names=0.6, horiz=T)
beepr::beep(10)
write.csv(resultados,'Entregable_CONEVAL.csv')
getwd
getwd()
getwd('stuff')
setwd('stuff')
setwd('..')
setwd('../Documents/GitHub')
setwd('datamexico-covid')
covid <- read.csv('data_mexico_covid_states.csv',stringsAsFactors = F)
mobile <- read.csv('2020_MX_Region_Mobility_Report.csv',stringsAsFactors = F)
covid$fecha <- covid$Time %>% as.Date()
mobile$fecha <- mobile$date %>% as.Date()
library(dplyr)
covid$fecha <- covid$Time %>% as.Date()
mobile$fecha <- mobile$date %>% as.Date()
covid$semana <- covid$fecha %>% data.table::week()
mobile$semana <- mobile$fecha %>% data.table::week()
mobile %>%
filter(sub_region_1=='Aguascalientes') %>%
group_by(semana) %>%
summarise(mobil=mean(retail_and_recreation_percent_change_from_baseline,na.rm=T)) %>%
ggplot(aes(semana,mobil)) +
geom_line() +
theme_bw()
library(ggplot2)
mobile %>%
filter(sub_region_1=='Aguascalientes') %>%
group_by(semana) %>%
summarise(mobil=mean(retail_and_recreation_percent_change_from_baseline,na.rm=T)) %>%
ggplot(aes(semana,mobil)) +
geom_line() +
theme_bw()
mobile %>%
filter(sub_region_1=='Aguascalientes') %>%
select(semana,retail_and_recreation_percent_change_from_baseline,
grocery_and_pharmacy_percent_change_from_baseline,
parks_percent_change_from_baseline,
transit_stations_percent_change_from_baseline,
workplaces_percent_change_from_baseline,
residential_percent_change_from_baseline) %>%
reshape2::melt(id=1) %>%
rename(tipo_viaje=variable) %>%
group_by(semana,tipo_viaje) %>%
summarise(mobil=mean(value,na.rm=T)) %>%
ggplot(aes(semana,mobil,col=tipo_viaje)) +
geom_line() +
theme_bw()
covid %>%
filter(State =='aguascalientes-ag') %>%
select(semana,Daily.Cases,Daily.Deaths,Daily.Hospitalized,Daily.Suspect) %>%
reshape2::melt(id=1) %>%
rename(tipo_caso=variable) %>%
group_by(semana,tipo_caso) %>%
summarise(casos=mean(value,na.rm=T)) %>%
ggplot(aes(semana,casos,col=tipo_caso)) +
geom_line() +
geom_point()
covid %>%
filter(State =='aguascalientes-ag') %>%
group_by(semana) %>%
summarise(casos=sum(Daily.Deaths,na.rm=T)) %>%
ggplot(aes(semana,casos)) +
geom_line() +
theme_bw()
